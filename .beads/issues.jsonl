{"id":"digihub-chatbot-0yh","title":"Increase chunk size and overlap parameters","description":"**Type:** enhancement","acceptance_criteria":"- [ ] Increase chunk size to 1500-2000 tokens\n- [ ] Increase overlap to 150-200 tokens\n- [ ] Consider adaptive chunking based on document structure\n- [ ] Use semantic boundaries rather than just token counts\n\n---","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T10:58:34.266845+05:30","updated_at":"2026-02-04T13:01:59.517301+05:30","closed_at":"2026-02-04T13:01:59.517301+05:30","close_reason":"Increased chunk size from 1000 to 1500 tokens and overlap from 100 to 150 tokens in both config.py (default values) and chunking_params.py enum","labels":["data-pipeline","medium"]}
{"id":"digihub-chatbot-0yz","title":"Fix contextual service lines overriding user authorization","description":"**Type:** bug\n\nFor session-dependent queries, retrieval is restricted to previous session's service lines, even if user is authorized for more. Follow-up questions about different topics get incomplete results.\n\n**File:** response_generator.py:426-472\n**Example:** User authorized for Billing, but follow-up restricted to previous topic (Airport Solutions)","acceptance_criteria":"- [ ] Don't restrict to previous service lines for follow-ups\n- [ ] Use full authorized service lines for retrieval\n- [ ] Only use contextual filtering as a boost, not restriction","status":"closed","priority":2,"issue_type":"task","owner":"zohaib.tanwir@gmail.com","created_at":"2026-02-04T14:40:46.075444+05:30","created_by":"zohaibtanwir","updated_at":"2026-02-04T14:46:33.123474+05:30","closed_at":"2026-02-04T14:46:33.123484+05:30","labels":["critical","query-pipeline","retrieval"]}
{"id":"digihub-chatbot-111","title":"Add validChunk field to uploaded chunks","description":"**Type:** bug","acceptance_criteria":"- [ ] Add validChunk = \"yes\" to document structure\n- [ ] Implement chunk validation logic\n- [ ] Run migration script for existing chunks\n\n---","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T10:58:34.263881+05:30","updated_at":"2026-02-04T12:22:57.755895+05:30","closed_at":"2026-02-04T12:22:57.755897+05:30","labels":["critical","data-pipeline","schema"]}
{"id":"digihub-chatbot-2u1","title":"Create unit tests for dataprocessor.py","description":"**Type:** testing\n**Priority:** CRITICAL\n**Coverage Target:** 80%\n\nCreate unit tests for the core document processing engine.\n\n**File:** data-pipeline/tests/test_dataprocessor.py\n\n**Test Cases Required:**\n\n1. **Chunking Tests**\n   - test_chunk_document_respects_size_limit\n   - test_chunk_document_maintains_overlap\n   - test_chunk_document_empty_content\n   - test_chunk_document_small_content\n\n2. **Image Path Processing Tests**\n   - test_update_image_paths_forward_slash\n   - test_update_image_paths_absolute_url\n   - test_update_image_paths_no_images\n\n3. **Chunk Validation Tests**\n   - test_validate_chunk_minimum_tokens\n   - test_validate_chunk_heading_only\n   - test_validate_chunk_valid_content\n   - test_validate_chunk_whitespace_only\n\n4. **Duplicate Detection Tests**\n   - test_detect_exact_duplicate\n   - test_detect_near_duplicate\n   - test_reset_duplicate_tracking\n   - test_jaccard_similarity_calculation\n\n5. **Question Generation Integration Tests**\n   - test_process_chunk_generates_questions\n   - test_process_chunk_question_fallback\n   - test_process_chunk_invalid_skips_questions\n\n6. **Embedding Generation Tests**\n   - test_process_chunk_generates_embeddings\n   - test_process_chunk_questions_embedding\n   - test_process_chunk_embedding_error_handling\n\n7. **Full Pipeline Tests**\n   - test_process_document_end_to_end\n   - test_process_document_with_images\n   - test_process_document_marks_invalid_chunks\n\n**Dependencies to Mock:**\n- AzureOpenAIService\n- EmbeddingService\n- QuestionGeneratorService\n- CosmosDB operations","status":"open","priority":1,"issue_type":"task","owner":"zohaib.tanwir@gmail.com","created_at":"2026-02-04T16:49:35.032524+05:30","created_by":"zohaibtanwir","updated_at":"2026-02-04T16:49:35.032524+05:30","labels":["critical","data-pipeline","testing"]}
{"id":"digihub-chatbot-5by","title":"Create unit tests for query_analyzer.py","description":"**Type:** testing\n**Priority:** CRITICAL\n**Coverage Target:** 80%\n\nCreate unit tests for query classification and analysis module.\n\n**File:** query-pipeline/tests/tests/test_query_analyzer.py\n\n**Test Cases Required:**\n\n1. **Language Detection Tests**\n   - test_analyze_query_english\n   - test_analyze_query_german\n   - test_analyze_query_french\n   - test_analyze_query_spanish (parametrized)\n\n2. **Session Dependency Tests**\n   - test_analyze_query_detects_session_dependency\n   - test_analyze_query_independent_query\n   - test_analyze_query_pronoun_detection\n\n3. **Service Line Extraction Tests**\n   - test_analyze_query_extracts_service_lines\n   - test_analyze_query_multiple_service_lines\n   - test_analyze_query_no_service_lines\n\n4. **Query Type Tests**\n   - test_analyze_query_handles_acronyms\n   - test_analyze_query_information_type\n   - test_analyze_query_how_to_type\n\n5. **Error Handling Tests**\n   - test_analyze_query_llm_error_fallback\n   - test_analyze_query_invalid_response\n\n**Dependencies to Mock:**\n- AzureOpenAIService","status":"open","priority":1,"issue_type":"task","owner":"zohaib.tanwir@gmail.com","created_at":"2026-02-04T16:49:24.568368+05:30","created_by":"zohaibtanwir","updated_at":"2026-02-04T16:49:24.568368+05:30","labels":["critical","query-pipeline","testing"]}
{"id":"digihub-chatbot-5ho","title":"Fix image path backslash to forward slash","description":"**Type:** bug","acceptance_criteria":"- [ ] Change backslash to forward slash in path replacement\n- [ ] Test image rendering in markdown output\n\n---","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T10:58:34.267832+05:30","updated_at":"2026-02-04T13:07:35.720939+05:30","closed_at":"2026-02-04T13:07:35.720939+05:30","close_reason":"Changed backslash to forward slash in image path replacement (lines 453 and 503) for proper cross-platform markdown image rendering","labels":["data-pipeline","low"]}
{"id":"digihub-chatbot-5qq","title":"Create unit tests for response_generator.py","description":"**Type:** testing\n**Priority:** CRITICAL\n**Coverage Target:** 80%\n\nCreate comprehensive unit tests for the main RAG orchestration engine.\n\n**File:** query-pipeline/tests/tests/test_response_generator.py\n\n**Test Cases Required:**\n\n1. **Reference Resolution Tests**\n   - test_resolve_query_references_with_pronouns\n   - test_resolve_query_references_no_pronouns\n   - test_resolve_query_references_session_independent\n\n2. **Service Line Determination Tests**\n   - test_determine_service_lines_uses_all_authorized\n   - test_determine_service_lines_no_keyword_restriction\n   - test_determine_service_lines_impersonation_mode\n\n3. **Out-of-Scope Detection Tests**\n   - test_detect_out_of_scope_explicit_true\n   - test_detect_out_of_scope_explicit_false_trusted\n   - test_detect_out_of_scope_low_confidence\n   - test_detect_out_of_scope_text_matching\n\n4. **Relevance Filtering Tests**\n   - test_filter_relevant_chunks_no_forced_minimum\n   - test_filter_relevant_chunks_empty_result\n   - test_filter_relevant_chunks_all_relevant\n\n5. **Contextual Service Lines Tests**\n   - test_get_contextual_service_lines_no_restriction\n   - test_get_contextual_service_lines_session_dependent\n\n6. **Integration Tests**\n   - test_generate_response_happy_path\n   - test_generate_response_out_of_scope\n   - test_generate_response_unauthorized\n\n**Dependencies to Mock:**\n- QueryAnalyzer\n- RelevanceJudge\n- AuthorizationChecker\n- ContextManager\n- RetreivalService\n- SessionDBService\n- AzureOpenAIService","status":"open","priority":1,"issue_type":"task","owner":"zohaib.tanwir@gmail.com","created_at":"2026-02-04T16:49:15.025742+05:30","created_by":"zohaibtanwir","updated_at":"2026-02-04T16:49:15.025742+05:30","labels":["critical","query-pipeline","testing"]}
{"id":"digihub-chatbot-63a","title":"Fix VectorDistance to similarity conversion (negative scores bug)","description":"**Type:** bug\n**Severity:** CRITICAL\n\n## Problem\nCosmosDB VectorDistance with cosine metric returns values in [0, 2] range, but code assumed [0, 1] and used 1 - distance formula.\n\nThis caused:\n- Distance 1.2 → Similarity -0.2 (NEGATIVE!)\n- Distance 1.8 → Similarity -0.8 (NEGATIVE!)\n- Good chunks filtered out due to negative hybrid scores\n\n## Fix\nAdded distance_to_similarity() helper that normalizes [0,2] to [0,1] and clamps result.\n\n## File\ndigihub-chatbot-query-pipeline/src/services/retrieval_service.py\n\n## Commit\n7959fd2","status":"closed","priority":1,"issue_type":"bug","owner":"zohaib.tanwir@gmail.com","created_at":"2026-02-04T17:28:04.573013+05:30","created_by":"zohaibtanwir","updated_at":"2026-02-04T17:28:09.761367+05:30","closed_at":"2026-02-04T17:28:09.761374+05:30","labels":["critical","query-pipeline","retrieval"]}
{"id":"digihub-chatbot-6hh","title":"Create test infrastructure (conftest.py, pytest.ini, .coveragerc)","description":"**Type:** infrastructure\n\nCreate shared test infrastructure for both pipelines:\n\n1. **conftest.py** (both pipelines)\n   - Centralized fixtures for mocking Azure services\n   - Shared mock data fixtures\n   - Auto-mock for Azure dependencies\n\n2. **pytest.ini** (both pipelines)\n   - Test discovery patterns\n   - Asyncio mode settings\n   - Markers (unit, integration, slow)\n\n3. **.coveragerc** (both pipelines)\n   - Source paths\n   - Exclusion patterns\n   - Minimum coverage threshold (70%)\n   - Branch coverage enabled\n\n4. **Update requirements.txt**\n   - Add pytest-cov==4.1.0\n   - Add pytest-xdist==3.5.0\n\n**Files to create:**\n- query-pipeline/tests/conftest.py\n- query-pipeline/pytest.ini\n- query-pipeline/.coveragerc\n- data-pipeline/tests/conftest.py\n- data-pipeline/pytest.ini\n- data-pipeline/.coveragerc","status":"open","priority":2,"issue_type":"task","owner":"zohaib.tanwir@gmail.com","created_at":"2026-02-04T16:49:03.347359+05:30","created_by":"zohaibtanwir","updated_at":"2026-02-04T16:49:03.347359+05:30","labels":["data-pipeline","infrastructure","query-pipeline","testing"]}
{"id":"digihub-chatbot-6jf","title":"Add relevance filtering before response generation","description":"**Type:** enhancement","acceptance_criteria":"- [ ] Call RelevanceJudge.judge_chunks_relevance() after retrieval\n- [ ] Filter out non-relevant chunks before response generation\n- [ ] Log filtered chunks for debugging\n- [ ] Consider using relevance scores to weight chunks\n\n---\n\n# Medium Priority Issues","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T10:58:34.265764+05:30","updated_at":"2026-02-04T12:53:47.389712+05:30","closed_at":"2026-02-04T12:53:47.389716+05:30","labels":["high","query-pipeline"]}
{"id":"digihub-chatbot-7z2","title":"Increase session context window from 1 to 5 messages","description":"**Type:** enhancement","acceptance_criteria":"- [ ] Increase context window to 5 recent Q\u0026A pairs\n- [ ] Make window size configurable via environment variable\n- [ ] Consider intelligent context selection based on relevance\n\n---","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T10:58:34.264651+05:30","updated_at":"2026-02-04T12:53:46.765512+05:30","closed_at":"2026-02-04T12:53:46.765521+05:30","labels":["high","query-pipeline"]}
{"id":"digihub-chatbot-apv","title":"Fix service line filtering to not exclude relevant documents","description":"**Type:** bug\n\nQuery analyzer guesses service lines from keywords, but may miss relevant ones. Query 'billing problem with my bag' extracts only ['Billing'], missing Bag Manager docs entirely.\n\n**File:** response_generator.py:886-903\n**Problem:** Keyword-based service line detection is unreliable","acceptance_criteria":"- [ ] Consider searching all authorized service lines first\n- [ ] Use service line detection as boost, not filter\n- [ ] Or expand detected service lines to include related ones","status":"closed","priority":2,"issue_type":"task","owner":"zohaib.tanwir@gmail.com","created_at":"2026-02-04T14:40:37.918038+05:30","created_by":"zohaibtanwir","updated_at":"2026-02-04T14:46:00.888724+05:30","closed_at":"2026-02-04T14:46:00.888735+05:30","labels":["critical","query-pipeline","retrieval"]}
{"id":"digihub-chatbot-aqk","title":"Add questionsEmbedding field to data pipeline","description":"**Type:** bug","acceptance_criteria":"- [ ] Generate synthetic questions for each chunk using LLM\n- [ ] Create questionsEmbedding from concatenated questions\n- [ ] Store both embedding and questionsEmbedding in document\n- [ ] Add questions array field for debugging\n\n---","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T10:58:34.263235+05:30","updated_at":"2026-02-04T12:22:57.576868+05:30","closed_at":"2026-02-04T12:22:57.576872+05:30","labels":["critical","data-pipeline","schema"]}
{"id":"digihub-chatbot-aut","title":"Implement metadata-based filtering in retrieval","description":"**Type:** enhancement","acceptance_criteria":"- [ ] Store metadata fields in chunks during indexing\n- [ ] Pass extracted metadata from query analyzer to retrieval\n- [ ] Add metadata filters to CosmosDB query\n- [ ] Implement fallback to unfiltered query if no results\n\n---","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T10:58:34.266247+05:30","updated_at":"2026-02-04T13:01:59.924425+05:30","closed_at":"2026-02-04T13:01:59.924425+05:30","close_reason":"Implemented metadata-based filtering in retrieval with ENABLE_METADATA_FILTERING config flag, supporting contentType and year filters from query analyzer","labels":["medium","query-pipeline"]}
{"id":"digihub-chatbot-boj","title":"Implement proper context formatting for LLM","description":"**Type:** enhancement","acceptance_criteria":"- [ ] Format context as structured markdown or numbered sections\n- [ ] Include clear labels for each chunk (source file, section heading)\n- [ ] Use proper JSON formatting if structure is needed\n\n---","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T10:58:34.265051+05:30","updated_at":"2026-02-04T12:53:47.052726+05:30","closed_at":"2026-02-04T12:53:47.05273+05:30","labels":["high","query-pipeline"]}
{"id":"digihub-chatbot-btu","title":"Remove duplicate translation key in JSON schema","description":"**Type:** bug","acceptance_criteria":"- [ ] Remove duplicate key\n- [ ] Consolidate instruction into one clear definition\n\n---","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T10:58:34.268125+05:30","updated_at":"2026-02-04T13:07:18.121267+05:30","closed_at":"2026-02-04T13:07:18.121267+05:30","close_reason":"Consolidated duplicate 'translation' keys in LANGUAGE_DETECTION_TEMPLATE JSON schema into single clear definition","labels":["low","query-pipeline"]}
{"id":"digihub-chatbot-bv4","title":"Create unit tests for relevance_judge.py","description":"**Type:** testing\n**Priority:** HIGH\n**Coverage Target:** 75%\n\nCreate unit tests for LLM-based chunk relevance evaluation.\n\n**File:** query-pipeline/tests/tests/test_relevance_judge.py\n\n**Test Cases Required:**\n\n1. **Relevance Filtering Tests**\n   - test_judge_chunks_relevance_filters_irrelevant\n   - test_judge_chunks_relevance_all_relevant\n   - test_judge_chunks_relevance_none_relevant\n\n2. **Edge Case Tests**\n   - test_judge_chunks_relevance_empty_chunks\n   - test_judge_chunks_relevance_single_chunk\n   - test_judge_chunks_relevance_duplicate_service_lines\n\n3. **Error Handling Tests**\n   - test_judge_chunks_relevance_llm_error_fallback\n   - test_judge_chunks_relevance_invalid_response\n   - test_judge_chunks_relevance_timeout\n\n4. **Response Parsing Tests**\n   - test_parse_llm_response_valid\n   - test_parse_llm_response_missing_field\n   - test_parse_llm_response_wrong_type\n\n**Dependencies to Mock:**\n- AzureOpenAIService","status":"open","priority":2,"issue_type":"task","owner":"zohaib.tanwir@gmail.com","created_at":"2026-02-04T16:49:42.319578+05:30","created_by":"zohaibtanwir","updated_at":"2026-02-04T16:49:42.319578+05:30","labels":["high","query-pipeline","testing"]}
{"id":"digihub-chatbot-cq5","title":"Consolidate out-of-scope detection to single consistent signal","description":"**Type:** bug\n\nOut-of-scope detection uses 4 contradictory signals that can fire independently, causing flaky behavior where same query gets different results.\n\n**File:** response_generator.py:687-768\n**Signals:** is_out_of_scope boolean, confidence\u003c0.4, text patterns, type=generic+confidence\u003c0.6","acceptance_criteria":"- [ ] Use single source of truth for out-of-scope (LLM is_out_of_scope boolean)\n- [ ] Remove conflicting confidence threshold checks\n- [ ] Remove text pattern matching fallback\n- [ ] Test consistency across repeated queries","status":"closed","priority":2,"issue_type":"task","owner":"zohaib.tanwir@gmail.com","created_at":"2026-02-04T14:40:30.041903+05:30","created_by":"zohaibtanwir","updated_at":"2026-02-04T14:44:58.638499+05:30","closed_at":"2026-02-04T14:44:58.638516+05:30","labels":["critical","query-pipeline","response"]}
{"id":"digihub-chatbot-dti","title":"Add CI/CD test integration in Azure Pipelines","description":"**Type:** infrastructure\n**Priority:** MEDIUM\n\nAdd automated test execution and coverage reporting in Azure Pipelines.\n\n**Files to Create/Modify:**\n\n1. **azure-pipelines.test.yml** (new)\n   - Trigger on main and develop branches\n   - Install dependencies\n   - Run pytest with coverage\n   - Publish test results (JUnit format)\n   - Publish coverage results (Cobertura format)\n   - Fail build if coverage \u003c 70%\n\n2. **azure-pipelines.ci.yml** (modify)\n   - Add test stage before build\n   - Gate deployment on test success\n\n**Pipeline Steps:**\n```yaml\n- task: UsePythonVersion@0\n- script: pip install -r requirements.txt\n- script: pytest --cov=src --cov-report=xml --cov-fail-under=70\n- task: PublishTestResults@2\n- task: PublishCodeCoverageResults@1\n```\n\n**Acceptance Criteria:**\n- [ ] Tests run automatically on PR\n- [ ] Coverage report visible in Azure DevOps\n- [ ] Build fails if coverage drops below 70%\n- [ ] Test results visible in PR checks","status":"open","priority":2,"issue_type":"task","owner":"zohaib.tanwir@gmail.com","created_at":"2026-02-04T16:50:15.138556+05:30","created_by":"zohaibtanwir","updated_at":"2026-02-04T16:50:15.138556+05:30","labels":["ci-cd","infrastructure","testing"]}
{"id":"digihub-chatbot-dww","title":"Add chunk quality validation in data pipeline","description":"**Type:** enhancement","acceptance_criteria":"- [ ] Implement minimum content length validation (\u003e50 tokens)\n- [ ] Check for meaningful content beyond just headers\n- [ ] Detect and filter duplicate/near-duplicate chunks\n- [ ] Set validChunk = \"no\" for low-quality chunks\n\n---\n\n# Low Priority Issues","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T10:58:34.267522+05:30","updated_at":"2026-02-04T13:03:45.919099+05:30","closed_at":"2026-02-04T13:03:45.919099+05:30","close_reason":"Implemented chunk quality validation with: 1) Token-based minimum content check (MIN_TOKEN_COUNT=50 tokens), 2) Header-only content detection, 3) Exact duplicate detection using content hash, 4) Near-duplicate detection using Jaccard similarity (threshold=0.85), 5) Placeholder content detection. Added reset_duplicate_tracking() called per-file in dataprocessor.","labels":["data-pipeline","medium"]}
{"id":"digihub-chatbot-dzp","title":"Remove MIN_RELEVANCE_CHUNKS forcing irrelevant content","description":"**Type:** bug\n\nWhen relevance judge returns fewer chunks than MIN_RELEVANCE_CHUNKS, code forces top N chunks by score even if they're irrelevant. This injects garbage into LLM context.\n\n**File:** response_generator.py:668-675\n**Problem:** If 0 chunks are relevant, still forces top 2 irrelevant chunks","acceptance_criteria":"- [ ] Don't force minimum chunks if relevance judge says none are relevant\n- [ ] Return empty/fewer chunks when appropriate\n- [ ] Let out-of-scope detection handle no-context cases","status":"closed","priority":2,"issue_type":"task","owner":"zohaib.tanwir@gmail.com","created_at":"2026-02-04T14:40:22.179668+05:30","created_by":"zohaibtanwir","updated_at":"2026-02-04T14:44:14.844087+05:30","closed_at":"2026-02-04T14:44:14.844093+05:30","labels":["critical","filtering","query-pipeline"]}
{"id":"digihub-chatbot-ehd","title":"Fix conflicting out-of-scope instructions in prompt template","description":"**Type:** bug\n\nRESPONSE_TEMPLATE has contradictory instructions for out-of-scope detection that confuse the LLM.\n\n**File:** prompt_template.py:311-323\n**Conflicts:**\n- 'Set is_out_of_scope=true if confidence \u003c 0.4'\n- 'Set is_out_of_scope=true if confidence 0.4-0.6 AND tangential'\n- 'High confidence (\u003e0.7) = in scope'","acceptance_criteria":"- [ ] Simplify to single clear instruction\n- [ ] Remove conflicting threshold guidance\n- [ ] Test LLM consistency with updated prompt","status":"closed","priority":2,"issue_type":"task","owner":"zohaib.tanwir@gmail.com","created_at":"2026-02-04T14:40:54.812092+05:30","created_by":"zohaibtanwir","updated_at":"2026-02-04T14:47:03.958846+05:30","closed_at":"2026-02-04T14:47:03.95886+05:30","labels":["critical","prompts","query-pipeline"]}
{"id":"digihub-chatbot-eip","title":"Fix hybrid scoring calculation for legacy chunks","description":"Fixed hybrid scoring for legacy chunks - apply 15% penalty and use content-only scoring","acceptance_criteria":"- [ ] Fix scoring to properly handle legacy chunks\n- [ ] Consider penalizing legacy chunks slightly\n- [ ] Log when legacy chunks are included in results","status":"closed","priority":2,"issue_type":"task","owner":"zohaib.tanwir@gmail.com","created_at":"2026-02-04T14:40:06.62656+05:30","created_by":"zohaibtanwir","updated_at":"2026-02-04T14:42:05.788339+05:30","closed_at":"2026-02-04T14:42:05.788353+05:30","labels":["critical","query-pipeline","retrieval"]}
{"id":"digihub-chatbot-f1v","title":"Improve citation processing code pattern","description":"**Type:** enhancement","acceptance_criteria":"- [ ] Make modification pattern explicit by reassigning result\n- [ ] Add return statement and capture it\n\n---","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T10:58:34.268471+05:30","updated_at":"2026-02-04T13:08:11.364446+05:30","closed_at":"2026-02-04T13:08:11.364446+05:30","close_reason":"Fixed citation processing pattern: explicitly capture return value from _process_citations() and reassign to structured_response. Updated docstring to clarify return value usage.","labels":["low","query-pipeline"]}
{"id":"digihub-chatbot-gre","title":"Fix ORDER BY to use questionsEmbedding instead of content embedding","description":"Fixed ORDER BY to use questionsEmbedding instead of embedding","acceptance_criteria":"- [ ] Change ORDER BY to use c.questionsEmbedding\n- [ ] Add fallback for legacy chunks without questionsEmbedding\n- [ ] Test retrieval quality improvement","status":"closed","priority":2,"issue_type":"task","owner":"zohaib.tanwir@gmail.com","created_at":"2026-02-04T14:39:58.772019+05:30","created_by":"zohaibtanwir","updated_at":"2026-02-04T14:41:39.21753+05:30","closed_at":"2026-02-04T14:41:39.217547+05:30","labels":["critical","query-pipeline","retrieval"]}
{"id":"digihub-chatbot-jis","title":"Create unit tests for authorization_checker.py","description":"**Type:** testing\n**Priority:** HIGH\n**Coverage Target:** 75%\n\nCreate unit tests for authorization validation module.\n\n**File:** query-pipeline/tests/tests/test_authorization_checker.py\n\n**Test Cases Required:**\n\n1. **Authorization Check Tests**\n   - test_check_authorization_user_subscribed\n   - test_check_authorization_user_not_subscribed\n   - test_check_authorization_impersonation_mode\n   - test_check_authorization_multiple_service_lines\n\n2. **Service Line Matching Tests**\n   - test_match_service_lines_exact_match\n   - test_match_service_lines_partial_match\n   - test_match_service_lines_no_match\n\n3. **Error Handling Tests**\n   - test_check_authorization_api_error\n   - test_check_authorization_invalid_response\n\n**Dependencies to Mock:**\n- AuthorizationService","status":"open","priority":2,"issue_type":"task","owner":"zohaib.tanwir@gmail.com","created_at":"2026-02-04T16:49:49.295737+05:30","created_by":"zohaibtanwir","updated_at":"2026-02-04T16:49:49.295737+05:30","labels":["high","query-pipeline","testing"]}
{"id":"digihub-chatbot-pvl","title":"Fix validChunk filter causing retrieval failures","description":"**Type:** bug","acceptance_criteria":"- [ ] Make filter conditional based on field existence\n- [ ] Add fallback query without filter if no results\n- [ ] Log when chunks are filtered by this condition\n\n---\n\n# High Priority Issues","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T10:58:34.264281+05:30","updated_at":"2026-02-04T12:26:37.047165+05:30","closed_at":"2026-02-04T12:26:37.047169+05:30","labels":["critical","query-pipeline","retrieval"],"dependencies":[{"issue_id":"digihub-chatbot-pvl","depends_on_id":"digihub-chatbot-111","type":"blocks","created_at":"2026-02-04T10:59:26.201899+05:30","created_by":"zohaibtanwir"}]}
{"id":"digihub-chatbot-sr0","title":"Implement structured out-of-scope detection","description":"**Type:** enhancement","acceptance_criteria":"- [ ] Add dedicated is_out_of_scope boolean to LLM response schema\n- [ ] Use confidence score thresholds as additional signal\n- [ ] Implement fuzzy matching or semantic similarity\n- [ ] Return structured response with explicit scope classification\n\n---","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T10:58:34.267171+05:30","updated_at":"2026-02-04T13:01:51.528495+05:30","closed_at":"2026-02-04T13:01:51.528495+05:30","close_reason":"Implemented structured out-of-scope detection with multiple signals: 1) Explicit is_out_of_scope boolean from LLM response schema, 2) Confidence score threshold (configurable via OUT_OF_SCOPE_CONFIDENCE_THRESHOLD, default 0.4), 3) Text-based matching fallback, 4) Generic type with low confidence check","labels":["medium","query-pipeline"]}
{"id":"digihub-chatbot-srv","title":"Split monolithic query analyzer prompt","description":"**Type:** enhancement","acceptance_criteria":"- [ ] Split into focused prompts for different concerns\n- [ ] Use smaller/faster models for simple tasks\n- [ ] Chain prompts with early exit conditions\n- [ ] Use structured output schemas (JSON mode) for each\n\n---","status":"in_progress","priority":2,"issue_type":"task","created_at":"2026-02-04T10:58:34.265408+05:30","updated_at":"2026-02-04T12:51:20.51799+05:30","labels":["high","query-pipeline"]}
{"id":"digihub-chatbot-syj","title":"Fix reference resolution disabled on service line change","description":"**Type:** bug\n\nReference resolution (resolving 'it', 'that', etc.) only runs when is_session_dependent=true. But when service lines change between questions, is_session_dependent is set to false, so pronouns are sent to retrieval unresolved.\n\n**File:** response_generator.py:489-499\n**Example:** 'Tell me more about it' sent as-is when topic changes","acceptance_criteria":"- [ ] Always check for references regardless of is_session_dependent\n- [ ] Resolve pronouns even when service line changes\n- [ ] Test with topic-switching conversations","status":"closed","priority":2,"issue_type":"task","owner":"zohaib.tanwir@gmail.com","created_at":"2026-02-04T14:40:14.473388+05:30","created_by":"zohaibtanwir","updated_at":"2026-02-04T14:43:32.752773+05:30","closed_at":"2026-02-04T14:43:32.752778+05:30","labels":["context","critical","query-pipeline"]}
{"id":"digihub-chatbot-uq3","title":"Enable hybrid re-ranking in retrieval service","description":"**Type:** bug","acceptance_criteria":"- [ ] Uncomment hybrid scoring code block (lines 324-358)\n- [ ] Ensure hybrid score properly weights question vs content similarity\n- [ ] Implement minimum question similarity threshold\n- [ ] Add logging for retrieval quality metrics\n\n---","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T10:58:34.261422+05:30","updated_at":"2026-02-04T12:26:37.232917+05:30","closed_at":"2026-02-04T12:26:37.23292+05:30","labels":["critical","query-pipeline","retrieval"],"dependencies":[{"issue_id":"digihub-chatbot-uq3","depends_on_id":"digihub-chatbot-aqk","type":"blocks","created_at":"2026-02-04T10:59:25.837839+05:30","created_by":"zohaibtanwir"},{"issue_id":"digihub-chatbot-uq3","depends_on_id":"digihub-chatbot-111","type":"blocks","created_at":"2026-02-04T10:59:26.013347+05:30","created_by":"zohaibtanwir"}]}
{"id":"digihub-chatbot-vyh","title":"Create integration tests for end-to-end flows","description":"**Type:** testing\n**Priority:** LOW\n\nCreate integration tests that test full workflows with minimal mocking.\n\n**Query Pipeline Integration Tests:**\n\n1. **test_chat_flow_integration.py**\n   - test_full_chat_request_response\n   - test_multi_turn_conversation\n   - test_out_of_scope_handling\n   - test_authorization_flow\n\n2. **test_retrieval_flow_integration.py**\n   - test_full_retrieval_pipeline\n   - test_hybrid_ranking_integration\n   - test_relevance_filtering_integration\n\n**Data Pipeline Integration Tests:**\n\n1. **test_document_processing_integration.py**\n   - test_full_document_to_chunks\n   - test_document_with_images\n   - test_question_generation_flow\n   - test_embedding_generation_flow\n\n**Prerequisites:**\n- Mock only external services (Azure, CosmosDB)\n- Test internal component interactions\n- Use realistic test data\n- Mark with @pytest.mark.integration\n\n**Acceptance Criteria:**\n- [ ] Integration tests in separate directory\n- [ ] Can run independently from unit tests\n- [ ] Document setup requirements","status":"open","priority":3,"issue_type":"task","owner":"zohaib.tanwir@gmail.com","created_at":"2026-02-04T16:50:25.429163+05:30","created_by":"zohaibtanwir","updated_at":"2026-02-04T16:50:25.429163+05:30","labels":["data-pipeline","low","query-pipeline","testing"]}
{"id":"digihub-chatbot-whj","title":"Add comprehensive logging and monitoring","description":"**Type:** enhancement","acceptance_criteria":"- [ ] Add retrieval quality metrics logging\n- [ ] Log similarity scores for all retrieved chunks\n- [ ] Add latency tracking for each pipeline stage\n- [ ] Implement health check endpoints with detailed status","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T10:58:34.268758+05:30","updated_at":"2026-02-04T13:10:11.558734+05:30","closed_at":"2026-02-04T13:10:11.558734+05:30","close_reason":"Added comprehensive logging and monitoring: 1) Created src/utils/metrics.py with RetrievalMetrics, LatencyTracker, PipelineMetrics classes, 2) Added /actuator/health/detailed endpoint with CosmosDB and Azure OpenAI status checks and config reporting, 3) Integrated RetrievalMetrics.log_chunk_scores() for all retrieved chunks, 4) Added RetrievalMetrics.log_filtering_results() for threshold and relevance filtering","labels":["low","observability"]}
{"id":"digihub-chatbot-xkz","title":"Add minimum similarity threshold for retrieval","description":"**Type:** enhancement","acceptance_criteria":"- [ ] Set meaningful default threshold (0.3-0.4)\n- [ ] Make threshold configurable via environment variable\n- [ ] Log similarity scores for quality monitoring\n- [ ] Consider adaptive thresholds based on query type\n\n---","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T10:58:34.266544+05:30","updated_at":"2026-02-04T13:01:59.720443+05:30","closed_at":"2026-02-04T13:01:59.720443+05:30","close_reason":"Added MIN_SIMILARITY_THRESHOLD config (default 0.35) for retrieval quality control with logging of top 5 hybrid scores","labels":["medium","query-pipeline"]}
{"id":"digihub-chatbot-zom","title":"Improve existing test coverage to 80%","description":"**Type:** testing\n**Priority:** MEDIUM\n\nEnhance existing test files to improve coverage.\n\n**Query Pipeline - Existing Tests to Enhance:**\n\n1. **test_retrieval_service.py** (Current: ~60%, Target: 85%)\n   - Add tests for new hybrid scoring with legacy penalty\n   - Add tests for questionsEmbedding ORDER BY\n   - Add edge case tests for empty results\n\n2. **test_context_manager.py** (Current: ~50%, Target: 80%)\n   - Add tests for reference resolution edge cases\n   - Add tests for entity extraction failures\n   - Add parametrized tests for different pronoun types\n\n3. **test_session_service.py** (Current: ~40%, Target: 75%)\n   - Add tests for service line tracking\n   - Add tests for entity persistence\n   - Add error handling tests\n\n4. **test_auth_service.py** (Current: ~30%, Target: 70%)\n   - Add tests for subscription status variations\n   - Add tests for API timeout handling\n\n**Data Pipeline - Existing Tests to Enhance:**\n\n1. **test_question_generator_service.py** (Current: ~70%, Target: 85%)\n   - Add tests for new duplicate detection\n   - Add tests for Jaccard similarity\n   - Add tests for validChunk field","status":"open","priority":2,"issue_type":"task","owner":"zohaib.tanwir@gmail.com","created_at":"2026-02-04T16:49:59.172527+05:30","created_by":"zohaibtanwir","updated_at":"2026-02-04T16:49:59.172527+05:30","labels":["data-pipeline","medium","query-pipeline","testing"]}
